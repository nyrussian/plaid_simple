<!-- index.html â€“ Links a sample bank account and renders balance information associated with the account. -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Credit Card Info</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    .header { font-size: 24px; margin-bottom: 20px; }
    button { padding: 5px 10px; margin-top: 10px; }
</style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
    <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
    <script>
      (async ($) => {
        // Grab a Link token to initialize Link
        const createLinkToken = async () => {
          const res = await fetch("/api/create_link_token");
          const data = await res.json();
          const linkToken = data.link_token;
          localStorage.setItem("link_token", linkToken);
          return linkToken;
        };

        // Initialize Link
        const handler = Plaid.create({
          token: await createLinkToken(),
          onSuccess: async (publicToken, metadata) => {
            await fetch("/api/exchange_public_token", {
              method: "POST",
              body: JSON.stringify({ public_token: publicToken }),
              headers: {
                "Content-Type": "application/json",
              },
            });
            await getProducts();
          },
          onEvent: (eventName, metadata) => {
            console.log("Event:", eventName);
            console.log("Metadata:", metadata);
          },
          onExit: (error, metadata) => {
            console.log(error, metadata);
          },
        });

        // Start Link when button is clicked
        const linkAccountButton = document.getElementById("link-account");
        linkAccountButton.addEventListener("click", (event) => {
          handler.open();
        });
      })(jQuery);

      // Retrieves balance and liability information
      const getProducts = async function () {
        const response = await fetch("/api/balance", {
          method: "GET",
        });
        const data = await response.json();
        const liabilities_response = await fetch("/api/liabilities", {
          method: "GET",
        });
        const liabilities_data = await liabilities_response.json();

        const combined_data = {
          ...data,
          liabilities: liabilities_data,
        };

        //Render response data
        const pre = document.getElementById("response");
        pre.textContent = JSON.stringify(combined_data, null, 2);
        pre.style.background = "#F6F6F6";
      };


      // Check whether account is connected
      const getStatus = async function () {
        const account = await fetch("/api/is_account_connected");
        const connected = await account.json();
        if (connected.status == true) {
          getProducts();
        }
      };

      getStatus();
    </script>
  </head>
  <body>
    <!-- <button
      type="button"
      id="link-account"
      class="btn btn-primary btn-dark btn-lg"
      style="
        border: 1px solid black;
        border-radius: 5px;
        background: black;
        height: 48px;
        width: 155px;
        margin-top: 5; 
        margin-left: 10;
        color: white;
        font-size: 18px;
      "
    >
      <strong>Link account</strong>
    </button> -->
    
    <h1 class="header">Credit Card Info</h1>
<button onclick="addTestRow()">Add Test Row</button>
<button type="button"id="link-account"><strong>Link account</strong></button>

<!-- <button ondblclick="addAccount()">Add Account (double click)</button> -->
<table id="infoTable">
    <thead>
        <tr>
            <th>Account Name</th>
            <th>Account Number</th>
            <th>Total Balance</th>
            <th>Credit Limit</th>
            <th>Interest Rate</th>
            <th>Last Payment Date</th>
            <th>Last Payment Amount</th>
            <th>Next Payment Due</th>
            <th>Refresh</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
        <!-- Rows will be added here by JavaScript -->
    </tbody>
    <tfoot>
        <tr>
            <td colspan="9">Total</td>
            <td id="totalAmount"></td>
        </tr>
    </tfoot>
</table>


<script>
    function addTestRow() {
        // Function to add an account
        const table = document.getElementById('infoTable').getElementsByTagName('tbody')[0];
        const newRow = table.insertRow(table.rows.length);

        for (let i = 0; i < 9; i++) {
            let newCell = newRow.insertCell(i);
            newCell.innerHTML = 'New data'; // Placeholder, replace with actual data
        }
        
        let refreshCell = newRow.insertCell(8);
        refreshCell.innerHTML = '<button onclick="refreshRow(this)">Refresh</button> <button onclick="deleteRow(this)">Delete</button>';
    }

    function refreshRow(button) {
        // Function to refresh a row
        alert("Refresh row " + button.parentNode.parentNode.rowIndex);
    }

    function deleteRow(button) {
        // Function to delete a row
        let row = button.parentNode.parentNode;
        let table = row.parentNode.parentNode;
        table.deleteRow(row.rowIndex);
    }
  </script>
    <pre
      id="response"
      style="
        top: 60;
        margin-left: 10;
        bottom: 0;
        overflow-y: scroll;
        overflow-x: hidden;
        font-size: 14px;
      "
    ></pre>
    <pre
    id="liabilities_response"
    style="
      top: 60;
      margin-left: 10;
      bottom: 0;
      overflow-y: scroll;
      overflow-x: hidden;
      font-size: 14px;
    "
  ></pre>

  </body>
</html>
